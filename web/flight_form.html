<!doctype html>

<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>Flightform JSON and AJAX</title>
  <meta name="description" content="Flightinfo JSON and AJAX">
  <meta name="author" content="Nico Bijl">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <!-- Normal css -->
  <link rel="stylesheet" href="main_sub_styles.css">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
  <!-- AJAX JSON > Watch tutorial: <a href="https://www.youtube.com/watch?v=rJesac0_Ftw">link</a> -->

  <!-- js flightnr fetch -->
  <script type="text/javascript">
    var fxml_url = 'http://nicobijl:0ea32a93f4389c4c347ad4fb59fb1889b9657fd1@flightxml.flightaware.com/json/FlightXML2/';
    // When the button is clicked, fetch the details about the entered flight identity
    $(document).ready(function() {
      $('#go_button_flight').click(function() {
        $.ajax({
          type: 'GET',
          url: fxml_url + 'FlightInfoEx',
          data: {
            'ident': $('#ident_text').val(),
            'howMany': 10,
            'offset': 0
          },
          success: function(result) {
            if (result.error) {
              alert('Please insert your flight number: ' + result.error);
              return;
            }
            for (flight of result.FlightInfoExResult.flights) {
              if (flight.actualdeparturetime > 0) {
                // display some textual details about the flight.
                $('#resultsFlight').html('Flight ' + flight.ident + ' from ' + flight.originName + ' to ' + flight.destinationName);
              }
            }
          },
          error: function(data, text) {
            alert('Please insert your destination: ' + data);
          },
          dataType: 'jsonp',
          jsonp: 'jsonp_callback',
          xhrFields: {
            withCredentials: true
          }
        });
      });
    });
	  
    // When the button is clicked, fetch all current flights for a specific Airport
    $(document).ready(function() {
      $('#go_button_airport').click(function() {
        $.ajax({
          type: 'GET',
          url: fxml_url + 'Enroute',
          data: {
            'airport': $('#airport_text').val(),
            'howMany': 10,
            'offset': 0
          },
          success: function(result) {
            if (result.error) {
              alert('Failed to fetch flights: ' + result.error);
              return;
            }
            renderHTML(result);
          },
          error: function(data, text) {
            alert('Failed to fetch flight: ' + data);
          },
          dataType: 'jsonp',
          jsonp: 'jsonp_callback',
          xhrFields: {
            withCredentials: true
          }
        });
      });
    });
    function renderHTML(data) {
      //console.log(data.EnrouteResult);
      var htmlString = "";
      htmlString += "<table>";
      htmlString += "<tr>";
      htmlString += "<th>FLIGHT NR</th>";
      htmlString += "<th>DEPARTURE</th>";
      htmlString += "<th>ARRIVAL</th>";
      htmlString += "<th>ORIGIN</th>";
      htmlString += "<th>DESTINATION</th>";
      htmlString += "</tr>";
		
      for (i = 0; i < data.EnrouteResult.enroute.length; i++) {
        htmlString += "<tr>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].ident + "</td>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].filed_departuretime + "</td>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].estimatedarrivaltime + "</td>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].originCity + "</td>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].destinationCity + "</td>";
        htmlString += "</tr>";
      }
      htmlString += "</table>";
      var flightContainer = document.getElementById("resultsAirportTable");
      flightContainer.insertAdjacentHTML('beforeend', htmlString);
    }
  </script>
  <!-- / js flightnr fetch -->
  </head>

  <!-- Body -->
  <body>
<body>
<!-- Navigation -->
<nav class="navbar default navbar-fixed-top col-md-offset-0 col-md-12 col-lg-12 col-lg-offset-0">
    <div class="container-fluid"> 
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" > <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
        <a class="navbar-brand"><img src="./img/logo_belle.png" alt="Belle AIR" style="width:150px;"> </a></div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right" style="margin-right: 50px;">
        <li><a href="home_menu.html">Home</a> </li>
        <li><a href="movies_genres.html">Movies</a> </li>
        <li><a href="games.html">Games</a> </li>
        <li class="active"><a href="flight_form.html">Flight info</a> </li>
        <li><a href="Internet.html">Internet</a> </li>
        <li class="dropdown"> <a href="music_genres.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true">Music <span class="caret"></span></a>
            <ul class="dropdown-menu">
            <li><a href="music_genres.html">Genres</a> </li>
            <li><a href="music_artists.html">Artists</a> </li>
            <li><a href="music_songs.html">Songs</a> </li>
          </ul>
          </li>
      </ul>
      </div>
  </div>
  </nav>
<!-- /Navigation --> 

<!-- Header -->
<header>
    <div class="page-header col-lg-offset-0 col-lg-12">
    <div class="row">
        <div class="col-md-12 padding-5">
        <div class="row">
            <div class="col-md-4 col-lg-2"></div>
            <div class="col-sm-12 text-center col-lg-offset-1 col-lg-3"> <img src="img/icon/menu_flight_info.png" class="img-responsive moviestitle" alt="Responsive image" style="padding-left: 1em "></div>
          </div>
        <div class="row">
            <div class="col-lg-4 col-lg-offset-3">
            <h1 style="color: white; text-align: right; padding-right: 2em">&nbsp;</h1>
          </div>
          </div>
      </div>
      </div>
  </div>
  </header>
<div class="container">
    <div class="row-centered" style="text-align: left;">
    <div class="group col-lg-offset-3 col-md-9 col-md-offset-2 col-lg-7" style="margin-bottom: 20px;"> 
        
        <!--   input flight number   -->
        <h3 class="title-small"> <span>Your flight number</span></h3>
        <p class="col-lg-offset-0 col-lg-12">To track your flight we need your flight number. </p>
        <form onsubmit="return false;">
        <p class="col-lg-offset-0 col-lg-12">Please enter your flight number: <br>
            <input type="text" name="ident" id="ident_text" value="" />
            <input class="btn btn-danger " type="submit" id="go_button_flight" value="Flight info" />
          </p>
      </form>
        <!--  / input flight number   -->
        <div id="resultsFlight"></div>
        <p class="content-detail">&nbsp;</p>
        <form onsubmit="return false;">
        <h4 class="title-small col-lg-offset-0 col-lg-12"> <span>Don't remember?</span></h4>
        <p class="col-lg-offset-0 col-lg-12" >If you don't remember your flight number you can first insert your destination to choose between flights.</p>
        <p class="col-lg-offset-0 col-lg-12">Please enter your destination airport code: <br>
            <input type="text" name="airport" id="airport_text" value="PHNL" />
            <input class="btn btn-danger " type="submit" id="go_button_airport" value="Fetch flights" />
          </p>
        <br>
        <div class="table table-hover table-responsive" id="resultsAirportTable" style="text-align: center;"></div>
      </form>
      </div>
  </div>
  </div>

<!-- FOOTER -->
<section>
    <div class="row">
    <footer class="footer"  style="text-align: center;">
        <div class="col-xs-12 col-lg-6 col-lg-offset-3" id="footer">
        <p>Copyright Â© SKY is the LIMIT</p>
      </div>
      </footer>
  </div>
    </div>
  </section>
<!-- / FOOTER -->

</body>
</html>