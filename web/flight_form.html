<!doctype html>

<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>Flightform JSON and AJAX</title>
  <meta name="description" content="Flightinfo JSON and AJAX">
  <meta name="author" content="Nico Bijl">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <!-- Normal css -->
  <link rel="stylesheet" href="main_sub_styles.css">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
  <!-- AJAX JSON > Watch tutorial: <a href="https://www.youtube.com/watch?v=rJesac0_Ftw">link</a> -->

  <!-- js flightnr fetch -->
  <script type="text/javascript">
    var fxml_url = 'http://nicobijl:0ea32a93f4389c4c347ad4fb59fb1889b9657fd1@flightxml.flightaware.com/json/FlightXML2/';
    // When the button is clicked, fetch the details about the entered flight identity
     
	   // When the button is clicked, fetch the details about the entered flight identity
    $(document).ready(function() {
      $('#go_button_flight').click(function() {
        $.ajax({
          type: 'GET',
          url: fxml_url + 'FlightInfoEx',
          data: {
            'ident': $('#ident_text').val(),
            'howMany': 10,
            'offset': 0
          },
          success: function(result) {
            if (result.error) {
              alert('Please insert your flight number: ' + result.error);
              return;
            }
            console.log(result.FlightInfoExResult);

           for (flight of result.FlightInfoExResult.flights) {
              if (flight.actualdeparturetime > 0) {

                // display some textual details about the flight.
                $('#resultsFlight').html(

                  // Flight Number block of text next to picture plane
                  '<div id="flightNumberBox">' +
                  '<br>' +
                  '<p>' + 'Flight Number: ' + flight.ident + '</p>' +
                  '<p>' + 'Aircraft type: ' + flight.aircrafttype + '</p>' +
                  '<p>' + 'Speed: ' + flight.filed_airspeed_kts + ' kts' + '</p>' +
                  '<p>' + 'Altitude: ' + flight.filed_altitude + ' meter' + '</p>' +
                  '<br>' +
                  '</div>')
				
				$('#flightFromBoxLeft').html(
                  // From block of text below picture plane on left side
                  '<div id="flightFromBoxLeft">' +
                  '<br>' +
                  '<p>' + 'From: ' + flight.originCity + '</p>' +
                  '<p>' + 'Airport: ' + flight.origin + '</p>' +
                  '<p>' + 'Departure (filed) : ' + new Date(flight.filed_departuretime * 1000) + '</p>' +
                  '<p>' + 'Departure (actual) : ' + new Date(flight.actualdeparturetime * 1000) + '</p>' +
                  '<br>' +
                  '</div>')
				

				$('#flightFromBoxRight').html(
  				// To block of text below picture plane on right side
                  '<div id="flightFromBoxRight">' +
                  '<br>' +
                  '<p>' + 'To: ' + flight.destinationCity + '</p>' +
                  '<p>' + 'Airport: ' + flight.destination + '</p>' +
                  '<p>' + 'Arrival (expected) : ' + new Date(flight.estimatedarrivaltime * 1000) + '</p>' +
                  '<p>' + 'Landed: No' + '</p>' +
                  '<br>' +
                  '</div>'
				 )
                ;
              }
            }
			  
          },
          error: function(data, text) {
            alert('Failed to fetch flight: ' + data);
          },
          dataType: 'jsonp',
          jsonp: 'jsonp_callback',
          xhrFields: {
            withCredentials: true
          }
        });
      });
    });

    
	  
	  
    // When the button is clicked, fetch all current flights for a specific Airport
    $(document).ready(function() {
      $('#go_button_airport').click(function() {
        $.ajax({
          type: 'GET',
          url: fxml_url + 'Enroute',
          data: {
            'airport': $('#airport_text').val(),
            'howMany': 10,
            'offset': 0
          },
          success: function(result) {
            if (result.error) {
              alert('Failed to fetch flights: ' + result.error);
              return;
            }
            renderHTML(result);
          },
          error: function(data, text) {
            alert('Failed to fetch flight: ' + data);
          },
          dataType: 'jsonp',
          jsonp: 'jsonp_callback',
          xhrFields: {
            withCredentials: true
          }
        });
      });
    });
	  
	  
    function renderHTML(data) {
      //console.log(data.EnrouteResult);
      var htmlString = "";
      htmlString += "<table>";
      htmlString += "<tr>";
      htmlString += "<th>FLIGHT NR</th>";
      htmlString += "<th>DEPARTURE</th>";
      htmlString += "<th>ARRIVAL</th>";
      htmlString += "<th>ORIGIN</th>";
      htmlString += "<th>DESTINATION</th>";
      htmlString += "</tr>";
		

      for (i = 0; i < data.EnrouteResult.enroute.length; i++) {
        htmlString += "<tr>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].ident + "</td>";
        var timestamp = data.EnrouteResult.enroute[i].filed_departuretime;
        var time = convertTimestamp(timestamp);
        htmlString += "<td>" + time + "</td>"; 
		var timestamp = data.EnrouteResult.enroute[i].estimatedarrivaltime;
        var time = convertTimestamp(timestamp);
        htmlString += "<td>" + time + "</td>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].originCity + "</td>";
        htmlString += "<td>" + data.EnrouteResult.enroute[i].destinationCity + "</td>";
        htmlString += "</tr>";
      }
	  
      htmlString += "</table>";
      var flightContainer = document.getElementById("resultsAirportTable");
      flightContainer.insertAdjacentHTML('beforeend', htmlString);
    }
	  
	   // Start: Convert unix timestamp
    var timestamp = 0;

    function convertTimestamp(timestamp) {
      var d = new Date(timestamp * 1000), // Convert the passed timestamp to milliseconds
        yyyy = d.getFullYear(),
        mm = ('0' + (d.getMonth() + 1)).slice(-2), // Months are zero based. Add leading 0.
        dd = ('0' + d.getDate()).slice(-2), // Add leading 0.
        hh = d.getHours(),
        h = hh,
        min = ('0' + d.getMinutes()).slice(-2), // Add leading 0.
        ampm = 'AM',
        time;
      if (hh > 12) {
        h = hh - 12;
        ampm = 'PM';
      } else if (hh === 12) {
        h = 12;
        ampm = 'PM';
      } else if (hh === 0) {
        h = 12;
      }
      // ie: 2013-02-18, 8:35 AM
      time = yyyy + '-' + mm + '-' + dd + ', ' + h + ':' + min + ' ' + ampm;
      //console.log(time);
      return time;
    }
    convertTimestamp(timestamp);
    // End: Convert unix timestamp
	  
	  
  </script>
  </head>

  <!-- Body -->
  <body>
<body>
<!-- Navigation -->
<nav class="navbar default navbar-fixed-top col-md-offset-0 col-md-12 col-lg-12 col-lg-offset-0">
    <div class="container-fluid"> 
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" > <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
        <a class="navbar-brand"><img src="./img/logo_belle.png" alt="Belle AIR" style="width:150px;"> </a></div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right" style="margin-right: 50px;">
        <li><a href="home_menu.html">Home</a> </li>
        <li><a href="movies_genres.html">Movies</a> </li>
        <li><a href="games.html">Games</a> </li>
        <li class="active"><a href="flight_form.html">Flight info</a> </li>
        <li><a href="Internet.html">Internet</a> </li>
        <li class="dropdown"> <a href="music_genres.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true">Music <span class="caret"></span></a>
            <ul class="dropdown-menu">
            <li><a href="music_genres.html">Genres</a> </li>
            <li><a href="music_artists.html">Artists</a> </li>
            <li><a href="music_songs.html">Songs</a> </li>
          </ul>
          </li>
      </ul>
      </div>
  </div>
  </nav>
<!-- /Navigation --> 

<!-- Header -->
<header>
    <div class="page-header col-lg-offset-0 col-lg-12">
    <div class="row">
        <div class="col-md-12 padding-5">
        <div class="row">
            <div class="col-md-4 col-lg-2"></div>
            <div class="col-sm-12 text-center col-lg-offset-1 col-lg-3"> <img src="img/icon/menu_flight_info.png" class="img-responsive moviestitle" alt="Responsive image" style="padding-left: 1em "></div>
          </div>
        <div class="row">
            <div class="col-lg-4 col-lg-offset-3">
            <h1 style="color: white; text-align: right; padding-right: 2em">&nbsp;</h1>
          </div>
          </div>
      </div>
      </div>
  </div>
  </header>
<div class="container">
    <div class="row-centered" style="text-align: left;">
    <div class="group col-lg-offset-3 col-md-9 col-md-offset-2 col-lg-7" style="margin-bottom: 20px;"> 
        
        <!--   input flight number   -->
        <h3 class="title-small"> <span>Your flight number</span></h3>
        <p class="col-lg-offset-0 col-lg-12">To track your flight we need your flight number. </p>
        <form onsubmit="return false;">
        <p class="col-lg-offset-0 col-lg-12">Please enter your flight number: <br>
            <br>
            <input type="text" name="ident" id="ident_text" value="" />
            <input class="btn btn-danger " type="submit" id="go_button_flight" value="Flight info" />
          </p>
      </form>
        
        <!--  / input flight number   --> 
      </div>
  </div>
  </div>

<!--   results flight number   -->
<div class="container">
    <div class="row-centered" style="text-align: left;">
    <div class="col-lg-offset-3 col-lg-7" id="resultsFlight" > </div>
    <div class="col-lg-offset-3 col-lg-7" id="flightFromBoxLeft" > </div>
    <div class="col-lg-offset-3 col-lg-7" id="flightFromBoxRight" > </div>

    </div>
  </div>

<!--  / results flight number   -->

<div class="container ">
    <div class="row col-lg-offset-0 col-lg-12">
    <form onsubmit="return false;">
        <div class="group col-lg-offset-3 col-md-9 col-md-offset-2 col-lg-7" style="margin-bottom: 20px;">
        <h4 class="title-small col-lg-offset-0 col-lg-12"> <span>Don't remember?</span></h4>
        <p class="col-lg-offset-0 col-lg-12" >If you don't remember your flight number you can first insert your destination to choose between flights.</p>
        <p class="col-lg-offset-0 col-lg-12">Please enter your destination airport code: <br>
            <br>
            <input type="text" name="airport" id="airport_text" value="PHNL" />
            <input class="btn btn-danger " type="submit" id="go_button_airport" value="Fetch flights" />
          </p>
        <br>
        <div class="row-centered col-lg-offset-0 col-lg-12">
            <div class="table table-hover table-responsive" id="resultsAirportTable" style="text-align: center; margin-top: 40px;"></div>
          </div>
      </div>
      </form>
  </div>
  </div>

<!-- FOOTER -->
<section>
    <div class="row">
    <footer class="footer"  style="text-align: center;">
        <div class="col-xs-12 col-lg-6 col-lg-offset-3" id="footer">
        <p>Copyright © SKY is the LIMIT</p>
      </div>
      </footer>
  </div>
    </div>
  </section>
<!-- / FOOTER -->

</body>
</html>